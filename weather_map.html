<!DOCTYPE html>
<html>
<head>
    <title>Wheater Map Project</title>
    <link rel="stylesheet" href="CSS/bootstrap.css">
    <style>
        body {
            background-color: lightblue;
            background-image: url("images/weather.jpg");
        }
        
        .container {
            margin-top: 50px;
        }

        #printWeather, .col-lg-4 {
            height: 300px;
            background-color: steelblue;
            border: double;
            text-align: center;
            border-radius: 8px;
        }

        h1 {
            color: red;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        #map {
            width: 80vw;
            height: 500px;
            background-color: black;
            border-radius: 8px;
            margin-top: 10px;
        }

    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="text-center">Weather Forecast</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <h3>Weather forecast</h3>
        </div>

    </div>

    <div class="row">
        <div class="col-lg-3">
            <form method="get">
                <input id="lat" type="text" name="lat" placeholder="Enter latitude here">
                <input id="long" type="text" name="long" placeholder="Enter longitud here">
                <button class="btn btn-primary" id="getMapBtn">
                    Get map and weather location
                </button>
            </form>
        </div>
    </div>
    <div class="row" id="printWeather">

    </div>

    <div class="center-block" id="map"></div>


</div>

<!-- jQuery Version 2.2.4 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<!-- Google Maps -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKKYyyL0qO5WPswp3g3vmiicZbi2ESGrw"></script>

<!-- Custom JS -->
<script>
    $(document).ready(function() {
        "use strict";

        // ===================  INITIAL WEATHER FORECAST SAN ANTONIO
        $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
            APPID: "7f8e3aa0aad113510e0c1eaafd1c17b8",
            cnt: "3",
            q: "San Antonio, TX",
            units: "imperial"
        }).done(function (data) {
            buildWeatherHtml(data.list)
        });


        // =========function to get just one weather forecast ====
//        function makeWeatherReq() {
//            var sAweatherAjax = $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
//                APPID: "7f8e3aa0aad113510e0c1eaafd1c17b8",
//                cnt: "3",
//                q:     "San Antonio, TX",
//                units: "imperial"
//
//            });
//            sAweatherAjax.done(function(data) {
//                console.log(data);
//                console.log(data.list);
//                buildWeatherHtml(data.list);
////
//            });
//            sAweatherAjax.fail(function (jqXhr, status, error) {
//                console.log(status + "request failed");
//                console.log("error is: " + error);
//            });
//        };

//        makeWeatherReq();


        function buildWeatherHtml(arrObjs) {
            var weatherArrHtml = "";
            arrObjs.forEach(function (element, index, array) {
                weatherArrHtml += "<div class='col-lg-4'>"
                    + "<h3>" + element.temp.min + "&#176;/" + element.temp.max + "&#176;</h3>"
                    + "<div class='show_icon'>"
                        + "<img src='http://openweathermap.org/img/w/" + element.weather[0].icon + ".png'>"
                    + "</div>"
                    + "<p>" + "<strong>" + "Clouds: " + "</strong>" + element.clouds + "</p>"
                    + "<p>" + "<strong>" + "Humidity: " + "</strong>" + element.humidity + "</p>"
                    + "<p>" + "<strong>" + "Wind: " + "</strong>" + element.speed + "</p>"
                    + "<p>" + "<strong>" + "Pressure: " + "</strong>" + element.pressure + "</p>"
                    + "</div>";

            });

//            console.log(weatherArrHtml);
            $("#printWeather").html(weatherArrHtml);

        };


//=============================================== BUILDING THE MAP (the initial one)
//        -2.172280, -79.906401
//        var mapOptions = {
//            zoom: 10,
//            center: {
//                lat:  29.426791,
//                lng: -98.489602
//            }
//        };
//
//        function initMap(optionsObject) {
//            return new google.maps.Map(document.getElementById("map"), optionsObject);
//        }
//
//        var map = initMap(mapOptions);

//=========================================== lat and long input -- not finished ==========
        $("#getMapBtn").click(function (event) {
            event.preventDefault();
            var lat = parseFloat($("#lat").val());
            console.log("typeof lat:" + typeof lat);
            console.log(lat);
            var long = parseFloat($("#long").val());
            console.log(long);
            console.log("typeof long: " + typeof long);
          $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
            APPID: "7f8e3aa0aad113510e0c1eaafd1c17b8",
                cnt: "3",
                lat: lat,
                lon: long,
                units: "imperial"
        }).done(function (data) {
              console.log(data);
              buildWeatherHtml(data.list);
        }).fail(function () {
              console.log("ajax failed")
          });

        });

//========================== BUILDING THE MAP WITH A DRAGGABLE PIN
        var myLatlng = new google.maps.LatLng(29.426791,-98.489602);
        var mapOptions = {
            zoom: 5,
            center: myLatlng
        };

        function initMap(optionsObject) {
            return new google.maps.Map(document.getElementById("map"), optionsObject);
        };

        var map = initMap(mapOptions);


// Place a draggable marker on the map
        var marker = new google.maps.Marker({
            position: myLatlng,
            map: map,
            draggable:true,
            title:"Drag me!"
        });


        google.maps.event.addListener(marker, 'dragend', function (event) {
            var lat = this.getPosition().lat();
            var long = this.getPosition().lng();
            $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
                APPID: "7f8e3aa0aad113510e0c1eaafd1c17b8",
                cnt: "3",
                lat: lat,
                lon: long,
                units: "imperial"
            }).done(function (data) {
                buildWeatherHtml(data.list);
            });
        });





    });
</script>

</body>
</html>
</html>